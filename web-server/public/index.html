<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sol Sniper</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="styles.css" rel="stylesheet">
  <!-- AWS SDK -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1550.0.min.js"></script>
  <!-- Amazon Cognito Identity SDK -->
  <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>
  
  <!-- App Configuration -->
  <script src="config.js"></script>
  
  <!-- App Scripts (order matters) -->
  <script src="auth.js"></script>
  <script src="dashboard.js"></script>
  <script src="app.js"></script>
  <script src="script.js"></script>
</head>
<body>
  <!-- Auth Overlay -->
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-container">
      <div class="auth-box">
        <h2 class="text-center mb-4">Sol Sniper</h2>
        
        <!-- Login Form -->
        <form id="loginForm" class="auth-form">
          <h4 class="mb-3">Login</h4>
          <div class="mb-3">
            <input type="email" class="form-control" id="loginEmail" placeholder="Email" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
          </div>
          <div class="error-message" id="loginError"></div>
          <div class="success-message" id="loginSuccess"></div>
          <button type="submit" class="btn btn-primary w-100">Login</button>
          <div class="text-center mt-2">
            <a href="#" id="forgotPassword" class="text-primary">Forgot Password?</a>
          </div>
        </form>

        <!-- Reset Password Form -->
        <form id="resetPasswordForm" class="auth-form" style="display: none;">
          <h4 class="mb-3">Reset Password</h4>
          <div class="mb-3">
            <input type="email" class="form-control" id="resetEmail" placeholder="Email" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Send Reset Code</button>
          <div class="text-center mt-2">
            <a href="#" id="backToLogin" class="text-primary">Back to Login</a>
          </div>
        </form>

        <!-- New Password Form -->
        <form id="newPasswordForm" class="auth-form" style="display: none;">
          <h4 class="mb-3">Set New Password</h4>
          <div class="mb-3">
            <input type="text" class="form-control" id="resetCode" placeholder="Reset Code" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="newPassword" placeholder="New Password" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="confirmNewPassword" placeholder="Confirm New Password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Set New Password</button>
          <div class="text-center mt-2">
            <a href="#" id="backToReset" class="text-primary">Back to Reset</a>
          </div>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="auth-form" style="display: none;">
          <h4 class="mb-3">Register</h4>
          <div class="mb-3">
            <input type="email" class="form-control" id="registerEmail" placeholder="Email" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="registerPassword" placeholder="Password" required 
                   oninput="displayPasswordStrength(calculatePasswordStrength(this.value))">
            <div class="password-strength-meter mt-2">
              <div id="passwordStrengthIndicator" class="strength-meter"></div>
            </div>
            <small class="form-text text-muted">
              Password must be at least 8 characters long and include uppercase, lowercase, numbers, and special characters.
            </small>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required>
          </div>
          <div class="error-message" id="registerError"></div>
          <div class="success-message" id="registerSuccess"></div>
          <button type="submit" class="btn btn-primary w-100">Register</button>
        </form>

        <!-- Verification Form -->
        <form id="verifyForm" class="auth-form" style="display: none;">
          <h4 class="mb-3">Verify Account</h4>
          <p class="text-muted mb-3">A verification code has been sent to your email. Please enter it below.</p>
          <div class="mb-3">
            <input type="email" class="form-control" id="verifyEmail" placeholder="Email" required readonly>
          </div>
          <div class="mb-3">
            <input type="text" class="form-control" id="verifyCode" placeholder="Verification Code" required>
          </div>
          <div class="error-message" id="verifyError"></div>
          <div class="success-message" id="verifySuccess"></div>
          <button type="submit" class="btn btn-primary w-100">Verify Account</button>
           <div class="text-center mt-2">
            <a href="#" id="resendCode" class="text-primary">Resend Code?</a>
          </div>
        </form>

        <!-- Toggle Forms -->
        <div class="text-center mt-3">
          <a href="#" id="toggleAuth" class="text-primary">Don't have an account? Register</a>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h3>Sol Sniper</h3>
        <p>Trading Bot</p>
      </div>
      
      <div class="sidebar-content">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" data-nav="dashboard" href="#">
              <i class="bi bi-speedometer2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-nav="tokens" href="#">
              <i class="bi bi-coin"></i>
              Tokens
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-nav="positions" href="#">
              <i class="bi bi-briefcase"></i>
              Positions
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-nav="logs" href="#">
              <i class="bi bi-list-ul"></i>
              Logs
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-nav="config" href="#">
              <i class="bi bi-gear"></i>
              Configuration
            </a>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-footer">
        <div class="connection-status">
          <span>Status: </span>
          <span id="connectionStatus" class="text-warning">Connecting...</span>
        </div>
        <button onclick="logout()" class="btn btn-outline-danger btn-sm mt-2 w-100">
          <i class="bi bi-box-arrow-right"></i> Logout
        </button>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Section -->
      <div id="dashboardSection" class="content-section">
        <div class="section-header">
          <h2>Dashboard</h2>
          <div class="actions">
            <button class="btn btn-sm btn-outline-primary btn-refresh" data-refresh="dashboard">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
        </div>
        
        <div class="dashboard-header">
          <h1>Sol Sniper Dashboard</h1>
          <div id="userProfile" class="user-profile">
            <!-- User profile will be loaded here -->
          </div>
        </div>
        
        <!-- Wallet Status Card -->
        <div class="card status-card">
          <div class="card-body">
            <h5 class="card-title">Wallet Status <span id="walletStatus" class="badge bg-secondary">Checking...</span></h5>
            <div class="status-items">
              <div class="status-item">
                <span class="status-label">Address:</span>
                <span id="walletAddress" class="status-value">--</span>
              </div>
              <div class="status-item">
                <span class="status-label">Balance:</span>
                <span id="walletBalance" class="status-value">--</span>
              </div>
              <div class="status-item">
                <span class="status-label">RPC Endpoint:</span>
                <span id="rpcEndpoint" class="status-value">--</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Trading Stats Cards -->
        <div class="stats-container">
          <div class="card stats-card">
            <div class="card-body">
              <h5 class="card-title">Total Trades</h5>
              <div class="stats-value" id="totalTrades">--</div>
            </div>
          </div>
          
          <div class="card stats-card">
            <div class="card-body">
              <h5 class="card-title">Profitable Trades</h5>
              <div class="stats-value" id="profitableTrades">--</div>
            </div>
          </div>
          
          <div class="card stats-card">
            <div class="card-body">
              <h5 class="card-title">Success Rate</h5>
              <div class="stats-value" id="successRate">--</div>
            </div>
          </div>
          
          <div class="card stats-card">
            <div class="card-body">
              <h5 class="card-title">Total Profit</h5>
              <div class="stats-value" id="totalProfit">--</div>
            </div>
          </div>
        </div>
        
        <!-- Recent Detected Tokens -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Recently Detected Tokens</h5>
            <div id="tokensContainer" class="tokens-container">
              <div class="no-data">Loading tokens...</div>
            </div>
          </div>
        </div>
        
        <!-- Active Positions -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Active Positions</h5>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Token</th>
                    <th>Entry Price</th>
                    <th>Current Price</th>
                    <th>Quantity</th>
                    <th>PnL</th>
                    <th>Time Held</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="positionsTableBody">
                  <tr>
                    <td colspan="7" class="text-center">Loading positions...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- System Logs -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">System Logs</h5>
            <div id="logsContainer" class="logs-container">
              <div class="no-data">Loading logs...</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tokens Section -->
      <div id="tokensSection" class="content-section" style="display: none;">
        <div class="section-header">
          <h2>Tokens</h2>
          <div class="actions">
            <button class="btn btn-sm btn-outline-primary btn-refresh" data-refresh="tokens">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
        </div>
        <!-- Added containers for app.js -->
        <div id="tokensContainer">
          <!-- Token cards will be dynamically added here -->
        </div>
         <div id="allTokensContainer">
          <!-- All tokens table might go here -->
        </div>
      </div>
      
      <!-- Positions Section -->
      <div id="positionsSection" class="content-section" style="display: none;">
        <div class="section-header">
          <h2>Positions</h2>
          <div class="actions">
            <button class="btn btn-sm btn-outline-primary btn-refresh" data-refresh="positions">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
        </div>
        <!-- Added table bodies for app.js -->
        <h4>Active Positions</h4>
        <table class="table table-striped"><thead><tr><th>Token</th><th>Amount</th><th>Entry Price</th><th>Current Price</th><th>PNL</th><th>Actions</th></tr></thead><tbody id="activePositionsTableBody"></tbody></table>
        <h4>Closed Positions</h4>
        <table class="table table-striped"><thead><tr><th>Token</th><th>Amount</th><th>Entry Price</th><th>Exit Price</th><th>PNL</th><th>Timestamp</th></tr></thead><tbody id="closedPositionsTableBody"></tbody></table>
        <h4>All Positions (Combined)</h4>
        <table class="table table-striped"><thead><tr><th>Token</th><th>Status</th><th>Amount</th><th>Entry Price</th><th>Exit/Current Price</th><th>PNL</th><th>Timestamp</th></tr></thead><tbody id="positionsTableBody"></tbody></table>
      </div>
      
      <!-- Logs Section -->
      <div id="logsSection" class="content-section" style="display: none;">
        <div class="section-header">
          <h2>Logs</h2>
          <div class="actions">
            <button class="btn btn-sm btn-outline-primary btn-refresh" data-refresh="logs">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
        </div>
        <!-- Added container for app.js -->
        <div id="logsContainer" class="logs-container">
          <!-- Log entries will be added here -->
        </div>
      </div>
      
      <!-- Configuration Section -->
      <div id="configSection" class="content-section" style="display: none;">
        <div class="section-header">
          <h2>Configuration</h2>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Wallet Configuration</h5>
                <p class="text-danger"><i class="bi bi-exclamation-triangle-fill"></i> <strong>Security Warning:</strong> Entering your secret key here stores it in AWS Secrets Manager. While more secure than alternatives, handle with extreme care. Never share your key. Use a dedicated burner wallet if possible.</p>
                
                <div class="mb-3">
                    <label for="secretKeyInput" class="form-label">Solana Secret Key (Base58 Encoded)</label>
                    <input type="password" class="form-control" id="secretKeyInput" placeholder="Paste Base58 secret key here">
                    <small class="form-text text-muted">e.g., 4XQ...1Z9</small>
                </div>
                
                <button type="button" id="saveWalletKeyBtn" class="btn btn-primary">Save Wallet Key</button>
                <div id="walletConfigStatus" class="mt-2"></div> 
            </div>
        </div>

        <h5 class="mt-4">Trading Parameters</h5>
        <!-- Added form ID for app.js -->
        <form id="configForm">
          <!-- Existing configuration form fields here -->
          <!-- Example fields -->
          <div class="row mb-3">
              <div class="col-md-6">
                  <label for="tradeAmount" class="form-label">Default Trade Amount (SOL)</label>
                  <input type="number" class="form-control" id="tradeAmount" step="0.01" value="0.1">
              </div>
              <div class="col-md-6">
                 <label for="slippageTolerance" class="form-label">Slippage Tolerance (%)</label>
                 <input type="number" class="form-control" id="slippageTolerance" step="0.1" value="0.5">
             </div>
          </div>
           
          <button type="submit" class="btn btn-primary">Save Trading Parameters</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap & Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</body>
</html> 